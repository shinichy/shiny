function generateTestData(){var e=Array(5).join("../")+"/demo/kitchen-sink/docs",t=fs.readdirSync(cwd+e),n=fs.readdirSync(cwd),r=fs.readdirSync(cwd+"../").filter(function(e){return/^\w+_highlight_rules.js$/.test(e)}).map(function(e){return e.replace(/_highlight_rules.js$/,"")});console.log("Docs:",t),console.log("Modes:",r),t.forEach(function(t){var i=t.toLowerCase().split(".");if(!i[1])return;var s;r.indexOf(i[0])!=-1?s=i[0]:r.indexOf(i[1])!=-1?s=i[1]:s={txt:"text",cpp:"c_cpp"}[i[1]];var o="text_"+s+".txt";n.indexOf(o)==-1&&(o=e+"/"+t);var u=fs.readFileSync(cwd+o,"utf8");try{var a=require("../"+s).Mode}catch(f){console.warn("Can't load mode :"+s,f);return}var l=(new a).getTokenizer(),c="start",h=u.split(/\n|\r|\r\n/).map(function(e){var t=l.getLineTokens(e,c);return c=t.state,t=t.tokens,{state:c,data:t.map(function(e){return[e.type,e.value]})}}),p=JSON.stringify(h,null,1);p=p.replace(/\n {4}/g," ").replace(/\n {3}]/g," ]"),fs.writeFileSync(cwd+"tokens_"+s+".json",p,"utf8")})}function test(e){function n(e){var t;e[0]!==e[1]&&(console.log(e[0],e[1]),t=1);if(e[2]+""!=e[3]+""||e[4]+""!=e[5]+"")r(e[2],e[3]),r(e[4],e[5]),t=1;if(t)throw"error"}function r(e,t){var n=Math.max(e.length,t.length),r=[];for(var s=0;s<n;s++)r.push("\n",i(s+1,3),") "),e[s]!==t[s]?r.push("[31m",e[s]," != ",t[s],"[0m"):r.push(e[s]);console.log(r.join(""))}function i(e,t){return("      "+e).slice(-t)}var t=fs.readdirSync(cwd).filter(function(e){return/^tokens_\w+.json$/.test(e)});e&&e>1&&(t=t.slice(e-1)),t.forEach(function(e,t){var r=e.match(/tokens_(.*).json/)[1];console.log(i(t+1,3)+") testing: [33m"+r+"[0m");var s=fs.readFileSync(cwd+e,"utf8"),o=JSON.parse(s),u=require("../"+r).Mode,a=(new u).getTokenizer(),f="start";o.forEach(function(e){e.values=[],e.types=[],e.data.forEach(function(t){e.types.push(t[0]),e.values.push(t[1])});var t=e.values.join(""),r=a.getLineTokens(t,f),i=r.tokens.map(function(e){return e.value}),s=r.tokens.map(function(e){return e.type}),o=!0;n([e.state,r.state,e.types,s,e.values,i]),f=e.state})}),console.log("[32mall ok[0m")}var fs=require("fs");fs.existsSync||(fs.existsSync=require("path").existsSync),require("amd-loader");var cwd=__dirname+"/";process.argv[2]=="gen"?generateTestData(process.argv.splice(3)):test(parseInt(process.argv[2],10)||0);